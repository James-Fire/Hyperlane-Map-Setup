namespace = hyperlane_hubs

event = {
	id = hyperlane_hubs.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_system = {
			limit = {
				NOT = { exists = space_owner }
				NOT = { has_star_flag = sealed_system }
			}
			set_star_flag = hyperlane_hub_primary
			set_star_flag = hyperlane_hub
			system_event = { id = hyperlane_hubs.2 days = 1 }
			log = "Primary Hyperlane Hub on [This.GetName]"
			set_variable = { which = hyperlane_hubs value = 1 }
			save_global_event_target_as = hyperlane_hub_primary
		}
		while = {
			count = 70
			random_system = {
				limit = {
					NOT = { has_star_flag = hyperlane_hub }
					NOT = { has_star_flag = sealed_system }
					NOT = { exists = space_owner }
					closest_system = {
						limit = { has_star_flag = hyperlane_hub }
						min_steps = 1
						max_steps = 200
						distance = {
							source = prev
							min_distance >= 80
							max_distance <= 120
							type = euclidean
						}
					}
				}
				set_star_flag = hyperlane_hub
				log = "Hyperlane Hub on [This.GetName]"
				event_target:hyperlane_hub_primary = {
					change_variable = { which = hyperlane_hubs value = 1 }				
				}
			}
		}
	}
	
	after = {
	}
}

system_event = {
	id = hyperlane_hubs.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "[This.hyperlane_hubs] Hyperlane Hubs"
		log = "Remove all hyperlanes"
		every_system = {
            every_neighbor_system = {
                remove_hyperlane = { from = prev to = this }
            }
        }
		system_event = { id = hyperlane_hubs.3 days = 1 }
	}
	after = {
		
	}
}

system_event = {
	id = hyperlane_hubs.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Stage 1 Cluster Connections"
		every_system = {
			limit = {
				has_star_flag = hyperlane_hub
			}
			every_neighbor_system_euclidean = {
				limit = {
					NOT = { has_star_flag = hyperlane_hub }
					NOT = { has_star_flag = sealed_system }
					NOT = { has_star_flag = hyperlane_hub_1 }
					NOT = { has_star_flag = hyperlane_hub_2 }
					NOT = { has_star_flag = hyperlane_hub_3 }
					NOT = { has_star_flag = hyperlane_hub_4 }
					NOT = { has_hyperlane_to = prev }
				}
				add_hyperlane = { from = this to = prev }
				set_star_flag = hyperlane_hub_1
			}
		}
		system_event = { id = hyperlane_hubs.4 days = 1 }
	}
}

system_event = {
	id = hyperlane_hubs.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Stage 2 Cluster Connections"
		every_system = {
			limit = {
				has_star_flag = hyperlane_hub_1
			}
			every_neighbor_system_euclidean = {
				limit = {
					NOT = { has_star_flag = hyperlane_hub }
					NOT = { has_star_flag = sealed_system }
					NOT = { has_star_flag = hyperlane_hub_1 }
					NOT = { has_star_flag = hyperlane_hub_2 }
					NOT = { has_star_flag = hyperlane_hub_3 }
					NOT = { has_star_flag = hyperlane_hub_4 }
					NOT = { has_hyperlane_to = prev }
				}
				add_hyperlane = { from = this to = prev }
				set_star_flag = hyperlane_hub_2
			}
		}
		system_event = { id = hyperlane_hubs.5 days = 1 }
	}
}

system_event = {
	id = hyperlane_hubs.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Stage 3 Cluster Connections"
		every_system = {
			limit = {
				has_star_flag = hyperlane_hub_2
			}
			every_neighbor_system_euclidean = {
				limit = {
					NOT = { has_star_flag = hyperlane_hub }
					NOT = { has_star_flag = sealed_system }
					NOT = { has_star_flag = hyperlane_hub_1 }
					NOT = { has_star_flag = hyperlane_hub_2 }
					NOT = { has_star_flag = hyperlane_hub_3 }
					NOT = { has_star_flag = hyperlane_hub_4 }
					NOT = { has_hyperlane_to = prev }
				}
				add_hyperlane = { from = this to = prev }
				set_star_flag = hyperlane_hub_3
			}
		}
		system_event = { id = hyperlane_hubs.6 days = 1 }
	}
}

system_event = {
	id = hyperlane_hubs.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Stage 4 Cluster Connections"
		every_system = {
			limit = {
				has_star_flag = hyperlane_hub_3
			}
			every_neighbor_system_euclidean = {
				limit = {
					NOT = { has_star_flag = hyperlane_hub }
					NOT = { has_star_flag = sealed_system }
					NOT = { has_star_flag = hyperlane_hub_1 }
					NOT = { has_star_flag = hyperlane_hub_2 }
					NOT = { has_star_flag = hyperlane_hub_3 }
					NOT = { has_star_flag = hyperlane_hub_4 }
					NOT = { has_hyperlane_to = prev }
				}
				add_hyperlane = { from = this to = prev }
				set_star_flag = hyperlane_hub_4
			}
		}
		system_event = { id = hyperlane_hubs.7 days = 1 }
	}
}

system_event = {
	id = hyperlane_hubs.7
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Conneting Cluster Systems"
		every_system = {
			limit = {
				OR = {
					has_star_flag = hyperlane_hub_1
					has_star_flag = hyperlane_hub_2
					has_star_flag = hyperlane_hub_3
					has_star_flag = hyperlane_hub_4
				}
			}
			every_neighbor_system_euclidean = {
				limit = {
					NOT = { has_hyperlane_to = prev }
					OR = {
						has_star_flag = hyperlane_hub
						has_star_flag = hyperlane_hub_1
						has_star_flag = hyperlane_hub_2
						has_star_flag = hyperlane_hub_3
						has_star_flag = hyperlane_hub_4
					}
					NOT = { has_star_flag = sealed_system }
					distance = {
						source = prev
						min_jumps = 1
						max_jumps = 10
						type = hyperlane
					}
					distance = {
						source = prev
						min_distance >= 1
						max_distance <= 40
						type = euclidean
					}
				}
				add_hyperlane = { from = this to = prev }
			}
		}
		system_event = { id = hyperlane_hubs.8 days = 1 }
	}
}

system_event = {
	id = hyperlane_hubs.8
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Link Hyperlane Hubs"
		every_system = {
			limit = {
				has_star_flag = hyperlane_hub
			}
			every_system = {
				limit = {
					has_star_flag = hyperlane_hub
					NOT = { has_hyperlane_to = prev }
					distance = {
						source = prev
						min_distance >= 1
						max_distance <= 170
						type = euclidean
					}
				}
				add_hyperlane = { from = this to = prev }
			}
		}
		#system_event = { id = hyperlane_hubs.2 days = 1 }
	}
}